import{u as E,a as C,L,e as F,Q as m,r as K,a8 as f,a4 as V,X as b,a9 as P,i as Q,s as W,l as n,k as c,q as e,aa as M,p as _,t as v,m as o,ab as Y,a2 as B,Y as j,S as z,U as A,V as I,W as q,a3 as G,v as T,x as U,$ as H,ac as Z,ad as D,a0 as J}from"./vendor.b28878af.js";import{L as O}from"./VueElementLoading.common.fb72b886.js";import{u as X}from"./index.f23bfad6.js";const x=o("i",{class:"bi bi-plus-circle"},null,-1),ee=_("\xA0 "),te=o("i",{class:"bi bi-arrow-clockwise"},null,-1),ae={class:"pt-2"},le={class:"pt-2"},ne={props:{clients:Array},emits:["reload","created"],setup(R,{emit:y}){const{cookies:k}=E(),h=C.create({validateStatus:()=>!0}),s=L(),{t:r}=F();X();const p=m(!1),w=m(null),u=K({clientName:"",scope:"",avatar:"",response:{display:!1,clientId:"",clientSecret:""}}),N={clientName:[{required:!0,message:r("developer.center.new-client.validate.client-name")}],scope:[{required:!0,message:r("developer.center.new-client.validate.scope")}],avatar:[{required:!0,message:r("developer.center.new-client.validate.avatar")},{validator:(t,l)=>{if(!new RegExp(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/).test(l))return new Error(r("developer.center.new-client.validate.avatar-invalid"))}}]},g=m(!1);m(!1);const S=[{title:r("developer.center.client.avatar"),key:"avatar",render(t){return f("img",{width:32,height:32,class:"rounded-3",src:t.avatar})}},{title:r("developer.center.client.client-name"),key:"client_name"},{title:r("developer.center.client.client-id"),key:"client_id",render(t){return f("code",{onClick:()=>$(t.client_id)},t.client_id)}},{title:r("developer.center.client.scope"),key:"scope",render(t){return t.scope.split(",").map(d=>f(V,{style:{marginRight:"6px"},type:"info"},{default:()=>d}))}},{title:r("developer.center.client.created-at"),key:"created_at",render(t){return f("span",new Date(t.created_at).toLocaleString())}},{title:r("developer.center.client.action"),key:"actions",render(t){return f(b,{onClick:()=>i(t.client_id),strong:!0,size:"small",type:"error"},{default:()=>r("common.actions.delete")})}}];function $(t){P(t,void 0,l=>{l?(s.error(r("common.messages.copy-failed")),console.error(l)):s.success(r("common.messages.copy-success"))})}function a(){w.value.validate(t=>{t||(g.value=!0,h.put("/api/management/developer/client",{client_name:u.clientName,scope:u.scope,avatar:u.avatar},{headers:{Authorization:"Bearer "+k.get("access_token")}}).catch(()=>{s.error(r("common.messages.request-unknown-error")),g.value=!1}).then(l=>{if(l.status===400)s.warning(r("developer.center.messages.invalid")),g.value=!1;else{s.success(r("developer.center.messages.success"));const d={clientId:d.data.client.client_secret,clientSecret:d.data.client.client_secret};p.value=!1,g.value=!1,y("created",d),y("reload")}}))})}function i(t){confirm(r("developer.center.messages.confirm"))&&(console.log(t),h.delete("/api/management/developer/client?id="+t,{headers:{Authorization:"Bearer "+k.get("access_token")}}).then(()=>{s.success(r("developer.center.messages.deleted.0")+t.substring(0,8)+r("developer.center.messages.deleted.1")),y("reload")}))}return(t,l)=>(Q(),W("div",null,[n(e(b),{onClick:l[0]||(l[0]=d=>p.value=!0)},{icon:c(()=>[n(e(M),null,{default:c(()=>[x]),_:1})]),default:c(()=>[_(v(t.$t("developer.center.new")),1)]),_:1}),ee,n(e(b),{onClick:l[1]||(l[1]=d=>this.$router.go())},{icon:c(()=>[n(e(M),null,{default:c(()=>[te]),_:1})]),default:c(()=>[_(v(t.$t("developer.center.reload")),1)]),_:1}),o("div",ae,[o("div",le,[n(e(Y),{columns:S,data:R.clients,pagination:{pageSize:10}},null,8,["data"])]),n(e(G),{show:p.value,"onUpdate:show":l[8]||(l[8]=d=>p.value=d)},{default:c(()=>[n(e(B),{style:{width:"600px"},title:t.$t("developer.center.new-client.title"),bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:c(()=>[n(e(j),{ref_key:"newForm",ref:w,model:e(u),rules:N},{default:c(()=>[n(e(z),{label:t.$t("developer.center.new-client.client-name"),path:"clientName"},{default:c(()=>[n(e(A),{value:e(u).clientName,"onUpdate:value":l[2]||(l[2]=d=>e(u).clientName=d),onKeydown:l[3]||(l[3]=I(q(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),n(e(z),{label:t.$t("developer.center.new-client.scope"),path:"scope"},{default:c(()=>[n(e(A),{value:e(u).scope,"onUpdate:value":l[4]||(l[4]=d=>e(u).scope=d),placeholder:t.$t("developer.center.new-client.placeholders.scope"),onKeydown:l[5]||(l[5]=I(q(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(z),{label:t.$t("developer.center.new-client.avatar"),path:"avatar"},{default:c(()=>[n(e(A),{value:e(u).avatar,"onUpdate:value":l[6]||(l[6]=d=>e(u).avatar=d),placeholder:t.$t("developer.center.new-client.placeholders.avatar"),onKeydown:l[7]||(l[7]=I(q(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1},8,["label"]),n(e(b),{loading:g.value,style:{width:"100%"},type:"primary",onClick:a},{default:c(()=>[_(v(t.$t("common.actions.create")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])])]))}},se={class:"container"},re={class:"alert alert-success"},oe={class:"alert-heading"},ie=o("hr",null,null,-1),ce={class:"mb-0"},de={id:"statistics-display",class:"row mb-3"},ue={class:"col-3"},pe={class:"col-3"},ve={id:"loading"},we={setup(R){const{cookies:y}=E(),k=C.create({validateStatus:()=>!0}),h=L(),{t:s}=F(),r=X();m(!1),m(null);const p=K({clientName:"",scope:"",avatar:"",response:{display:!1,clientId:"",clientSecret:""}});s("developer.center.new-client.validate.client-name"),s("developer.center.new-client.validate.scope"),s("developer.center.new-client.validate.avatar"),m(!1);const w=m(!1),u=m([]),N=m({});s("developer.center.client.avatar"),s("developer.center.client.client-name"),s("developer.center.client.client-id"),s("developer.center.client.scope"),s("developer.center.client.created-at"),s("developer.center.client.action");function g(a){P(a,void 0,i=>{i?(h.error(s("common.messages.copy-failed")),console.error(i)):h.success(s("common.messages.copy-success"))})}function S(a){confirm(s("developer.center.messages.confirm"))&&(console.log(a),k.delete("/api/management/developer/client?id="+a,{headers:{Authorization:"Bearer "+y.get("access_token")}}).then(()=>{h.success(s("developer.center.messages.deleted.0")+a.substring(0,8)+s("developer.center.messages.deleted.1")),$()}))}function $(){w.value=!0;const a=k.get("/api/management/developer/client",{headers:{Authorization:"Bearer "+y.get("access_token")}});C.all([a]).then(C.spread((...i)=>{i[0].status===200?(N.value=i[0].data.statistics,u.value=i[0].data.data,w.value=!1):(h.error(s("common.messages.request-unknown-error")),console.error("Request response errors: ",i),w.value=!1)}))}return $(),(a,i)=>(Q(),W("div",se,[T(o("div",re,[o("div",null,[o("h4",oe,v(a.$t("developer.center.new-client-success.title")),1),o("p",null,v(a.$t("developer.center.new-client-success.description")),1),ie,o("div",ce,[o("div",null,[_(v(a.$t("developer.center.client.client-id"))+": ",1),o("code",{onClick:i[0]||(i[0]=t=>g(e(p).response.clientId))},v(e(p).response.clientId),1)]),o("div",null,[_(v(a.$t("developer.center.client.client-secret"))+": ",1),o("code",{onClick:i[1]||(i[1]=t=>g(e(p).response.clientSecret))},v(e(p).response.clientSecret),1)])])])],512),[[U,e(p).response.display]]),o("div",null,[o("h3",null,v(a.$t("developer.center.title")),1),o("div",de,[o("div",ue,[n(e(B),null,{default:c(()=>[n(e(Z),{label:a.$t("developer.center.statistic.grant-count")},{default:c(()=>[n(e(D),{from:0,to:N.value.grantedUsers},null,8,["to"])]),_:1},8,["label"])]),_:1})]),o("div",pe,[n(e(B),null,{default:c(()=>[n(e(Z),{label:a.$t("developer.center.statistic.registered-clients")},{default:c(()=>[n(e(D),{from:0,to:u.value.length},null,8,["to"])]),_:1},8,["label"])]),_:1})])]),n(e(H),{type:"line",animated:""},{default:c(()=>[n(e(J),{name:"clients",tab:a.$t("developer.center.clients")},{default:c(()=>[n(ne,{clients:u.value,onReload:i[2]||(i[2]=t=>$())},null,8,["clients"])]),_:1},8,["tab"])]),_:1})]),T(o("div",ve,[n(e(O),{active:w.value||e(r).status.pulling,"is-full-screen":""},null,8,["active"])],512),[[U,w.value||e(r).status.pulling]])]))}};export{we as default};
