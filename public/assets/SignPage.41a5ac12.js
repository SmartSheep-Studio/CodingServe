import{u as Z,_ as z}from"./index.f23bfad6.js";import{e as U,u as F,a as A,L as P,g as B,f as D,Q as _,r as M,i as C,s as N,m as v,l as a,k as u,q as e,S as c,U as y,V as b,W as k,X as K,p as h,t as q,Y as S,Z as I,_ as T,o as L,$ as j,a0 as V}from"./vendor.b28878af.js";const W={setup(R){const{t}=U(),{cookies:g}=F(),d=Z(),$=A.create({validateStatus:()=>!0}),l=P(),i=B(),w=D(),p=_(!1),o=_(null),f=M({username:"",password:"",remember:!1}),E={username:[{required:!0,message:t("user.login.validate.username")}],password:[{required:!0,message:t("user.login.validate.password")}]};function n(){var s;(s=o.value)==null||s.validate(r=>{r||(p.value=!0,$.post("/api/authenticate",{username:f.username,password:f.password}).then(m=>{m.status===201?(l.success(t("user.login.messages.success")),console.log("[SAFETY] Successfully logged in, there is your JWT, please do not share to anyone, just for client development and test: ",m.data.token),f.remember?g.set("access_token",m.data.token,"30d"):g.set("access_token",m.data.token,0),w.params.redirect?i.push(w.params.redirect).then(()=>d.init()):i.push({name:"introduce"}).then(()=>d.init())):m.status===401?l.warning(t("user.login.messages.invalid")):l.error(t("common.messages.request-unknown-error")),p.value=!1}).catch(m=>{l.error(t("common.messages.request-unknown-error")),l.error(m.message),p.value=!1}))})}return(s,r)=>(C(),N("div",null,[v("div",null,[v("div",null,[a(e(S),{ref_key:"form",ref:o,model:e(f),rules:E},{default:u(()=>[a(e(c),{label:s.$t("user.login.username"),path:"username"},{default:u(()=>[a(e(y),{value:e(f).username,"onUpdate:value":r[0]||(r[0]=m=>e(f).username=m),onKeydown:r[1]||(r[1]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(c),{label:s.$t("user.login.password"),path:"password"},{default:u(()=>[a(e(y),{value:e(f).password,"onUpdate:value":r[2]||(r[2]=m=>e(f).password=m),type:"password",onKeydown:r[3]||(r[3]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(K),{loading:p.value,style:{width:"100%"},type:"primary",onClick:n},{default:u(()=>[h(q(s.$t("common.actions.login")),1)]),_:1},8,["loading"])]),_:1},8,["model"])])])]))}},Y={key:0},J={class:"pt-2 text-center"},Q={class:"text-secondary"},X={key:1},x={setup(R){const{t}=U(),g={username:[{required:!0,message:t("user.register.validate.username")}],email:[{required:!0,message:t("user.register.validate.email")},{validator:(n,s)=>{if(!new RegExp(/^\w+((.\w+)|(-\w+))@[A-Za-z0-9]+((.|-)[A-Za-z0-9]+).[A-Za-z0-9]+$/).test(s))return new Error(t("user.register.validate.email-invalid"))}}],password:[{required:!0,message:t("user.register.validate.password")}],confirmPassword:[{required:!0,message:t("user.register.validate.confirm-password")},{validator:(n,s)=>{if(s!==o.password)return new Error(t("user.register.validate.confirm-password-invalid"))}}],verifyCode:[{required:!0,message:t("user.register.validate.verify-code")}]},d=B(),$=A.create({validateStatus:()=>!0}),l=P(),i=_(!1),w=_(null),p=_(0),o=M({email:"",username:"",password:"",confirmPassword:"",agreement:!1,verifyCode:""});function f(){var n;(n=w.value)==null||n.validate(s=>{s||(i.value=!0,$.post("/api/management/users",{username:o.username,password:o.password,email:o.email}).catch(()=>{l.error(t("common.message.request-unknown-error")),i.value=!1}).then(r=>{r.status===201?(l.success(t("user.register.messages.require-verify")),p.value++):r.data.error==="DataError#2"?l.warning(t("user.register.messages.used-email")):r.data.error==="DataError#1"?l.warning(t("user.register.messages.used-username")):(l.error(t("common.messages.request-unknown-error")),console.error("Request error: ",r)),i.value=!1}))})}function E(){var n;(n=w.value)==null||n.validate(s=>{s||(i.value=!0,$.post(`/api/management/users?verify=${o.verifyCode}`).catch(()=>{l.error(t("common.messages.request-unknown-error")),i.value=!1}).then(r=>{r.status===200?(l.success(t("user.register.messages.success")),d.push({name:"user.sign",query:{mode:"login"}}).then(()=>d.go())):r.data.error==="DataError"?l.warning(t("user.register.messages.invalid-verify")):(l.error(t("common.messages.request-unknown-error")),i.value=!1),i.value=!1}))})}return(n,s)=>(C(),N("div",null,[v("div",null,[p.value===0?(C(),N("div",Y,[a(e(S),{ref_key:"form",ref:w,model:e(o),rules:g},{default:u(()=>[a(e(c),{label:n.$t("user.register.username"),path:"username"},{default:u(()=>[a(e(y),{value:e(o).username,"onUpdate:value":s[0]||(s[0]=r=>e(o).username=r),onKeydown:s[1]||(s[1]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(c),{label:n.$t("user.register.email"),path:"email"},{default:u(()=>[a(e(y),{value:e(o).email,"onUpdate:value":s[2]||(s[2]=r=>e(o).email=r),onKeydown:s[3]||(s[3]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(c),{label:n.$t("user.register.password"),path:"password"},{default:u(()=>[a(e(y),{value:e(o).password,"onUpdate:value":s[4]||(s[4]=r=>e(o).password=r),type:"password",onKeydown:s[5]||(s[5]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(c),{label:n.$t("user.register.confirm-password"),path:"confirmPassword"},{default:u(()=>[a(e(y),{value:e(o).confirmPassword,"onUpdate:value":s[6]||(s[6]=r=>e(o).confirmPassword=r),type:"password",onKeydown:s[7]||(s[7]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(K),{loading:i.value,style:{width:"100%"},type:"primary",onClick:f},{default:u(()=>[h(q(n.$t("user.register.title")),1)]),_:1},8,["loading"]),v("div",J,[v("span",Q,[h(q(n.$t("user.register.agreement.0"))+" ",1),a(e(I),{to:{name:"agreement",query:{page:"user-must-known"}}},{default:u(()=>[h(q(n.$t("user.register.agreement.1")),1)]),_:1})])])]),_:1},8,["model"])])):T("",!0),p.value===1?(C(),N("div",X,[a(e(S),{ref_key:"form",ref:w,model:e(o),rules:g},{default:u(()=>[a(e(c),{label:n.$t("user.register.verify-code"),path:"verifyCode"},{default:u(()=>[a(e(y),{value:e(o).verifyCode,"onUpdate:value":s[8]||(s[8]=r=>e(o).verifyCode=r),onKeydown:s[9]||(s[9]=b(k(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1},8,["label"]),a(e(K),{loading:i.value,style:{width:"100%"},type:"primary",onClick:E},{default:u(()=>[h(q(n.$t("user.register.verify")),1)]),_:1},8,["loading"])]),_:1},8,["model"])])):T("",!0)])]))}},G={class:"container-fluid row",style:{height:"100%"}},H={class:"col-lg-3 col-md-4 col-sm-5 position-absolute top-50 start-50 translate-middle"},O=v("h4",{class:"text-center",style:{"line-height":"60px"}},[v("img",{alt:"LumbaShark",height:"80",src:z,width:"80"})],-1),ee={class:"card"},se={class:"card-body"},te={setup(R){const{t}=U(),g=P(),d=D(),$=d.query.mode?d.query.mode:"login";return L(()=>{d.params.message&&(d.params.i18nMesasge?g.info(t(d.params.message)):g.info(d.params.message))}),(l,i)=>(C(),N("div",G,[v("div",H,[O,v("div",ee,[v("div",se,[a(e(j),{type:"bar","justify-content":"space-evenly","default-value":e($)},{default:u(()=>[a(e(V),{name:"login",tab:l.$t("user.login.title")},{default:u(()=>[a(W)]),_:1},8,["tab"]),a(e(V),{name:"signup",tab:l.$t("user.register.title")},{default:u(()=>[a(x)]),_:1},8,["tab"])]),_:1},8,["default-value"])])])])]))}};export{te as default};
