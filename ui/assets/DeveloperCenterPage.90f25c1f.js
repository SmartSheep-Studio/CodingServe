import{u as V,a as N,D as Z,e as E,I as c,K as L,Z as m,_ as j,h as W,q as X,l as o,t as d,k as l,p as t,$ as b,j as s,X as g,a0 as G,a1 as H,v as J,M as O,m as w,a2 as P,a3 as I,a4 as M,a5 as U,S as $,V as C,U as z,W as S,R as Q}from"./vendor.d8a6652f.js";import{L as Y}from"./VueElementLoading.common.885381f6.js";import{u as x}from"./index.aa82df17.js";const ee={class:"container"},te={id:"statistics-display",class:"row mb-3"},ae={class:"col-3"},le={class:"col-3"},ne=o("i",{class:"bi bi-plus-circle"},null,-1),se=w("\xA0 "),re=o("i",{class:"bi bi-arrow-clockwise"},null,-1),oe={class:"pt-2",id:"clients-display"},ie={class:"pt-2"},ce={id:"loading"},me={setup(de){const{cookies:h}=V(),y=N.create({validateStatus:()=>!0}),u=Z(),{t:n}=E(),A=x(),f=c(!1),q=c(null),i=L({clientName:"",scope:"",avatar:""}),D={clientName:[{required:!0,message:n("developer.center.new-client.validate.client-name")}],scope:[{required:!0,message:n("developer.center.new-client.validate.scope")}],avatar:[{required:!0,message:n("developer.center.new-client.validate.avatar")},{validator:(e,a)=>{if(!new RegExp(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/).test(a))return new Error(n("developer.center.new-client.validate.avatar-invalid"))}}]},v=c(!1),p=c(!1),_=c([]),B=c({}),K=[{title:n("developer.center.client.avatar"),key:"avatar",render(e){return m("img",{width:32,height:32,class:"rounded-3",src:e.avatar})}},{title:n("developer.center.client.client-name"),key:"client_name"},{title:n("developer.center.client.client-id"),key:"client_id",render(e){return m("code",{onClick:()=>R(e.client_id),style:"cursor: copy"},e.client_id)}},{title:n("developer.center.client.scope"),key:"scope",render(e){return e.scope.split(",").map(r=>m(P,{style:{marginRight:"6px"},type:"info"},{default:()=>r}))}},{title:n("developer.center.client.created-at"),key:"created_at",render(e){return m("span",new Date(e.created_at).toLocaleString())}},{title:n("developer.center.client.action"),key:"actions",render(e){return m(g,{onClick:()=>T(e.client_id),strong:!0,size:"small",type:"error"},{default:()=>n("common.actions.delete")})}}];function R(e){j(e,void 0,(a,r)=>{r&&console.error(r)})}function F(){q.value.validate(e=>{e||(v.value=!0,y.put("/api/management/developer/client",{client_name:i.clientName,scope:i.scope,avatar:i.avatar},{headers:{Authorization:"Bearer "+h.get("access_token")}}).catch(()=>{u.error(n("common.messages.request-unknown-error")),v.value=!1}).then(a=>{a.status===400?(u.warning(n("developer.center.messages.invalid")),v.value=!1):(u.success(n("developer.center.messages.success")),f.value=!1,v.value=!1,k())}))})}function T(e){confirm(n("developer.center.messages.confirm"))&&(console.log(e),y.delete("/api/management/developer/client?id="+e,{headers:{Authorization:"Bearer "+h.get("access_token")}}).then(()=>{u.success(n("developer.center.messages.deleted.0")+e.substring(0,8)+n("developer.center.messages.deleted.1")),k()}))}function k(){p.value=!0;const e=y.get("/api/management/developer/client",{headers:{Authorization:"Bearer "+h.get("access_token")}});N.all([e]).then(N.spread((...a)=>{a[0].status===200?(B.value=a[0].data.statistics,_.value=a[0].data.data,p.value=!1):(u.error(n("common.messages.request-unknown-error")),console.error("Request response errors: ",a),p.value=!1)}))}return k(),(e,a)=>(W(),X("div",ee,[o("div",null,[o("h3",null,d(e.$t("developer.center.title")),1),o("h4",null,d(e.$t("developer.center.statistics")),1),o("div",te,[o("div",ae,[l(t(b),null,{default:s(()=>[l(t(I),{label:e.$t("developer.center.statistic.grant-count")},{default:s(()=>[l(t(M),{from:0,to:B.value.grantedUsers},null,8,["to"])]),_:1},8,["label"])]),_:1})]),o("div",le,[l(t(b),null,{default:s(()=>[l(t(I),{label:e.$t("developer.center.statistic.registered-clients")},{default:s(()=>[l(t(M),{from:0,to:_.value.length},null,8,["to"])]),_:1},8,["label"])]),_:1})])]),o("h4",null,d(e.$t("developer.center.clients")),1),l(t(g),{onClick:a[0]||(a[0]=r=>f.value=!0)},{icon:s(()=>[l(t(U),null,{default:s(()=>[ne]),_:1})]),default:s(()=>[w(d(e.$t("developer.center.new")),1)]),_:1}),se,l(t(g),{onClick:a[1]||(a[1]=r=>this.$router.go())},{icon:s(()=>[l(t(U),null,{default:s(()=>[re]),_:1})]),default:s(()=>[w(d(e.$t("developer.center.reload")),1)]),_:1}),o("div",oe,[o("div",ie,[l(t(G),{columns:K,data:_.value,pagination:{pageSize:10}},null,8,["data"])]),l(t(H),{show:f.value,"onUpdate:show":a[8]||(a[8]=r=>f.value=r)},{default:s(()=>[l(t(b),{style:{width:"600px"},title:e.$t("developer.center.new-client.title"),bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:s(()=>[l(t(Q),{ref_key:"newForm",ref:q,model:t(i),rules:D},{default:s(()=>[l(t($),{label:"Client Name",path:"clientName"},{default:s(()=>[l(t(C),{value:t(i).clientName,"onUpdate:value":a[2]||(a[2]=r=>t(i).clientName=r),onKeydown:a[3]||(a[3]=z(S(()=>{},["prevent"]),["enter"]))},null,8,["value"])]),_:1}),l(t($),{label:"Scope",path:"scope"},{default:s(()=>[l(t(C),{value:t(i).scope,"onUpdate:value":a[4]||(a[4]=r=>t(i).scope=r),placeholder:e.$t("developer.center.new-client.placeholders.scope"),onKeydown:a[5]||(a[5]=z(S(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1}),l(t($),{label:"Avatar",path:"avatar"},{default:s(()=>[l(t(C),{value:t(i).avatar,"onUpdate:value":a[6]||(a[6]=r=>t(i).avatar=r),placeholder:e.$t("developer.center.new-client.placeholders.avatar"),onKeydown:a[7]||(a[7]=z(S(()=>{},["prevent"]),["enter"]))},null,8,["value","placeholder"])]),_:1}),l(t(g),{loading:v.value,style:{width:"100%"},type:"primary",onClick:F},{default:s(()=>[w(d(e.$t("common.actions.create")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])])]),J(o("div",ce,[l(t(Y),{active:p.value||t(A).status.pulling,"is-full-screen":""},null,8,["active"])],512),[[O,p.value||t(A).status.pulling]])]))}};export{me as default};
